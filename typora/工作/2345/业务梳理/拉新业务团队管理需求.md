# 拉新业务团队管理需求
## 需求分析
### 问题
- 团队管理主页面需分几个接口？
    - 如果是一个接口，分页问题怎么处理？
    - 如果多个接口，是否必要？
    - 二级KA收起？怎么分页？
    - 设置默认分成跟具体分成要不要分开存？

- 一级KA设置推广员分成后，能否取消设置？
- 一级KA未设置二级KA分成的情况下，二级KA怎么显示？能设置推广员分成吗
- 默认分成表跟自定义可否放在同一张表里，有什么影响？
- 默认分成重置后，历史分成比例怎么存？
- 固定金额和分成比例精确到多少？
- 根据ka的uid来的话会有很多重复，怎么解决？
- 用户提交也是提交的自身uid，非从cookie获取

- 用户提交的时候，设置默认全员跟默认二级KA，默认推广员，怎么区分
- ka_type可表示谁设置的，type作为设置的谁，但是一级KA设置的二级KA下的推广员，和一级KA下的推广员怎么区分，有必要区分吗
- 一级KA先设置推广员，再设置二级KA的固定金额，怎么加判断
- KA的单价怎么获取？

## 功能流程梳理
### 分成信息展示流程
#### 取数据逻辑
- 默认分成
    - 一级KA登录
        - 全部成员
            条件
            - ka_id=一级kaId,ka_type=kaType,target_id=0
        - 全部二级KA
            条件
            - ka_id=一级kaId,ka_type=kaType,type=0,target_id=0
        - 全部推广员
            条件
            - ka_id=一级kaId,ka_type=kaType,type=1,target_id=0
    - 二级KA登录
        - 全部推广员
            条件
            - ka_id=二级kaId,ka_type=kaType,type=1,target_id=0
            - ka_id=一级kaId,ka_type=kaType,type=1,target_id=0
            
            > 如果一级KA条件有值，则该值被隐藏
- 自定义分成
    - 一级KA登录
        - 自定义二级KA
            条件(优先级递增)
            - ka_id=一级kaId,type=0,target_id=0 
            - ka_id=一级KaId,type=0,target_id=targetId
        - 自定义推广员
            - 一级KA直属推广员
                条件(优先级递增)
                - ka_id=一级kaId,type=1,target_id=0 
                - ka_id=一级KaId,type=1,target_id=targetId
            - 一级KA下二级KA的推广员
                条件(优先级递增)
                - ka_id=二级kaId,type=1,target_id=0 
                - ka_id=二级KaId,type=1,target_id=targetId
                - ka_id=一级kaId,type=1,target_id=0 
                - ka_id=一级KaId,type=1,target_id=targetId
    - 二级KA登录
        - 二层KA归属
            条件(优先级递增)
            - ka_id=二级kaId,type=1,target_id=0 
            - ka_id=二级KaId,type=1,target_id=targetId
            - ka_id=一级kaId,type=1,target_id=0 
            - ka_id=一级KaId,type=1,target_id=targetId
           
            > 如果一级KA条件有值，则该值被隐藏
        - 直属于一级KA
            条件(优先级递增)
            - ka_id=二级kaId,type=1,target_id=0 
            - ka_id=二级KaId,type=1,target_id=targetId

#### 数据补全逻辑
##### 获取可设置分成范围
 - 一级KA登录：
    - 默认分成：
        - 全部成员默认
            - 取KA最小单价作为范围上限maxPrice
            - 下限为0
        - 二级KA默认
            - 已设置推广员分成
                - 固定金额
                    - minPrice
                        - 条件(优先级递增)
                            - 二级KA已设置推广员分成
                                - ka_type=2,laxin_type=laxinType,type=1,proportion_type=0 
                            
                             > 取其中最大值作为最小值minPrice
                            
                            - 一级KA已设置推广员分成
                                - ka_id=一级KAId,laxin_type=laxinType,type=1,leader_id<>二级KAId,proportion_type=0
                            
                             > 取其中最大值作为最小值minPrice
                                    
                        > 条件覆盖
                        最小比值为minPrice/maxPrice*100%
                    - maxPrice
                        - KA单价最小值
                - 比值
                    -  不需判断
            - 未设置推广员分成
                - 以一级KA单价为maxPrice
                - 0为minPrice
        - 推广员默认
            - 二级KA已设置
                - 固定金额
                    - 以二级KA最小金额作为最大金额
                - 比值
                    - 以二级KA最小比值与KA最小单价的乘积作为最大金额
            
            > 两者取最小值作为最大金额maxPrice,若都为0，则取KA单价最小值
            
            - 二级KA未设置
                - 固定金额
                    - 以KA最小单价为最大值
                - 比值
                    - 100%
    - 自定义分成
        - 自定义推广员
            同默认
        - 自定义二级KA
            同默认






- 二级KA登录
    - 自身proportion是否有值，且proportionType=0
        - 没值
            - maxPrice为0，不能设置分成
        - 有值
            - 以二级KA的最大单价为准


- 先设置了二级KA，再设置推广员分成
- 先设置了推广员分成，再设置二级KA分成

**前端判断maxPrice和minPrice时，要已proportionType=0为前提**

- 先对二级KA设置了比值，推广员怎么限制最大金额
- ~~先对推广员设置了固定金额，二级KA的比例怎么设置~~ 用min/max