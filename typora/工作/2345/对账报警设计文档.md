# 对账报警设计文档
## 对账开发流程
1. 新增total_expend_balance字段，存放用户累计支出金额
2. 获取pull_new_user_balance_detail表里前一天有更新记录的用户uid
3. 以2中获取到的uid为条件，以group by uid分组统计每个人的总收支记录
4. 将3中结果与pull_new_user_wallet表左连接，获取用户累计收入支出，可用金额，冻结金额等信息
5. 遍历4中获取到的表数据，确认记录与用户的对应关系，记录收入与累计收入是否一致，记录支出与累计支出是否一致，累计金额与剩余金额+累计支出+冻结金额是否一致
6. 对5中出现的错误信息进行记录，同时发送报警邮件给相关人员
7. 每天遍历前一天的提现流水记录表，执行以上2-6相关操作

### 程序流程图

![打款报警脚本流程图](media/15571203622711/%E6%89%93%E6%AC%BE%E6%8A%A5%E8%AD%A6%E8%84%9A%E6%9C%AC%E6%B5%81%E7%A8%8B%E5%9B%BE.png)
