# 负载均衡

负载均衡能够将`大量的请求`，根据`负载均衡算法`，分发到多台服务器上进行处理，使得所有服务器负载都维持在高效稳定的状态，以提高系统的`吞吐量`。此外，多个`服务实例`组成的`服务集群`，消除了`单点`问题，当某一个服务`实例宕机`时，负载均衡就不会将请求分发给它，而是转发给其他正常的服务实例，以此提高整个系统的可用性

## 负载均衡概念

**单实例部署缺点**：用户量提升无法应对请求、一旦出现问题，影响应用可以性

**负载均衡集群**：将用户请求分发给不同的服务实例，既提高了系统整体的吞吐量，也避免了因为单一服务实例宕机导致整个系统不可用的情况。

![null](https://gitee.com/vikieq/my_pic/raw/master/uPic/2021/10/11/m_14b08c7999331252e1d67df72466abd0_r.png)

## 负载均衡分类

### 软件负载均衡：客户端负载均衡、服务端负载均衡

**优点** 配置简单、成本低
**缺点**：软件所部署服务器的性能会成为整个系统吞吐量的瓶颈，并且还会产生单点错误

#### 服务端负载均衡

举例： Nginx 、LVS 、基于DNS负载均衡、反向代理负载均衡
**DNS负载均衡**
需要为相同的域名地址配置多个不同服务器的 IP 地址，客户端解析 DNS 地址时会根据负载均衡返回不同的 IP 地址，从而达到将请求负载到不同服务器的目的；
**反向代理负载均衡**
使用代理服务器，客户端向同一IP地址发送请求，代理服务器将请求按照一定的规则分发到下游的服务器集群进行处理，最常见的方式即服务网关。核心机制就是转发HTTP请求到不同的服务实例。

#### 客户端负载均衡

Spring Cloud 的 Ribbon 组件

```
客户端负载均衡和服务端负载均衡的核心差异在于谁感知可用服务列表，进行负载均衡操作
```

客户端负载均衡中，客户端实例都有一份自己要访问的可用`服务端地址列表数据`，这些列表可从`服务注册与发现中心`获取，然后根据`负载均衡算法`选择一个`实例`，使用其`IP 地址`来发送请求。

而在服务端负载均衡中，可用服务端地址列表数据只存在于`负载均衡集群`中，客户端往往只能通过`固定IP`地址来进行调用。二者的区别如下图所示：

![null](https://gitee.com/vikieq/my_pic/raw/master/uPic/2021/10/11/m_2b661b862271deb15a6572eae6a67dd4_r.png)

因为客户端负载均衡的计算执行过程是由客户端完成的，所以减轻了服务端的计算压力，并且可以根据客户端和服务端的地理或网络区域等因素进行更加优化的算法选择。但是因为客户端只是缓存了可用服务实例列表，`更新并不实时`，所以导致客户端可能会访问到`已经宕机或者不可用的服务实例`，影响用户的正常使用。而服务端负载均衡则可以更加敏锐地应对服务实例的上线、下线或变更，提供更高的稳定性和可用性。

### 硬件负载均衡

**优点**：够提供更高的性能、更加多样化的负载均衡策略和更加细粒度的流量管理
**缺点**: 成本极高，需要专门的硬件设备

举例： F5 负载均衡器
